name: Download MEXC APK and Create Release

on:
  workflow_dispatch:  # Allows manual triggering from the GitHub UI

jobs:
  download-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Install apkeep via Cargo
        uses: baptiste0928/cargo-install@v3
        with:
          crate: apkeep
          git: https://github.com/EFForg/apkeep.git

      - name: Download APK
        run: apkeep -a com.mexcpro.client .

      - name: Find downloaded APK file
        id: find-apk
        run: |
          APK_FILE=$(ls -1 *.apk | head -1)
          echo "file=$APK_FILE" >> $GITHUB_OUTPUT

      - name: Create GitHub Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          TAG="mexc-apk-$(date +%Y%m%d)"
          gh release create "$TAG" --title "MEXC APK Release $TAG" --notes "Latest APK for com.mexcpro.client downloaded via apkeep from APKPure." ./${{ steps.find-apk.outputs.file }}
